{% extends "admin/core/base.html" %}
{% load roles securitytags %}
{% load role_count %}


{% block title %}Dashboard{% endblock title %}
{% block title-section %}Dashboard{% endblock %}
{% block title-sub %}Summary{% endblock %}

{% comment "empty breadcrumb block to override default behaviour an ensure there is no breadcrumb" %}
{% endcomment %}
{% block breadcrumbs %}  
{% endblock breadcrumbs %}

{% block body %}

    <section>
       {% include "admin/elements/no_stage.html" %}

        <div class="row expanded" data-equalizer data-equalize-on="medium">
            {% include "admin/elements/core/editor_dashboard.html" %}
        </div>
        {% if is_reviewer %}
            <div class="large-4 columns end" data-equalizer-watch>
                <div class="box">
                    <div class="title-area">
                        <h2>Reviewer</h2>
                        <a href="{% url 'review_requests' %}" class="button">View Requests</a>
                    </div>
                    <div class="content">
                      {% with label="Review Requests" item_count=assigned_articles_for_user_review_count href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Accepted Reviews" item_count=assigned_articles_for_user_review_accepted_count href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Completed Reviews" item_count=assigned_articles_for_user_review_completed_count href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                    </div>
                </div>
            </div>
        {% endif %}
        {% user_has_role request 'copyeditor' as copyeditor %}
        {% if copyeditor and 'copyediting' in workflow_elements %}
            <div class="large-4 columns end" data-equalizer-watch>
                <div class="box">
                    <div class="title-area">
                        <h2>Copyeditor</h2>
                        <a href="{% url 'copyedit_requests' %}" class="button">View Requests</a>
                    </div>
                    <div class="content">
                      {% with label="Copyedit Requests" item_count=copyeditor_requests href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Accepted Requests" item_count=copyeditor_accepted_requests href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Completed Requests" item_count=copyeditor_completed_requests href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                    </div>
                </div>
            </div>
        {% endif %}
        {% user_has_role request 'typesetter' as typesetter %}
        {% if typesetter and 'production' in workflow_elements %}
            <div class="large-4 columns end" data-equalizer-watch>
                <div class="box">
                    <div class="title-area">
                        <h2>Production</h2>
                        <a href="{% url 'typesetter_requests' %}" class="button">View Requests</a>
                    </div>
                    <div class="content">
                      {% with label="Production Requests" item_count=typeset_tasks href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Accepted Requests" item_count=typeset_in_progress_tasks href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Completed Requests" item_count=typeset_completed_tasks href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                    </div>
                </div>
            </div>
        {% endif %}
        {% user_has_role request 'production' as production %}
        {% if production and 'production' in workflow_elements %}
            <div class="large-4 columns end" data-equalizer-watch>
                <div class="box">
                    <div class="title-area">
                        <h2>Production Manager</h2>
                        <a href="{% url 'production_list' %}" class="button">View Requests</a>
                    </div>
                    <div class="content">
                      {% with label="Articles in Production" item_count=production_articles_count href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                    </div>
                </div>
            </div>
        {% endif %}
        {% user_has_role request 'proofreader' as proofreader %}
        {% if 'proofing' in workflow_elements %}
        {% if proofreader or is_author  %}
            <div class="large-4 columns end" data-equalizer-watch>
                <div class="box">
                    <div class="title-area">
                        <h2>Proofreader</h2>
                        <a href="{% url 'proofing_requests' %}" class="button">View Requests</a>
                    </div>
                    <div class="content">
                      {% with label="Requests" item_count=new_proofing href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Accepted" item_count=active_proofing href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Completed" item_count=completed_proofing href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                    </div>
                </div>
            </div>
        {% endif %}
        {% endif %}

        {% if typesetter and 'proofing' in workflow_elements %}
            <div class="large-4 columns end" data-equalizer-watch>
                <div class="box">
                    <div class="title-area">
                        <h2>Proofing Corrections</h2>
                        <a href="{% url 'proofing_correction_requests' %}" class="button">View Requests</a>
                    </div>
                    <div class="content">
                      {% with label="Production Requests" item_count=new_proofing_typesetting href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Accepted Requests" item_count=active_proofing_typesetting href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                      {% with label="Completed Requests" item_count=completed_proofing_typesetting href="" %}
                        {% include "admin/core/dashboard_stat.html" %}
                      {% endwith %}
                    </div>
                </div>
            </div>
        {% endif %}

        {% if typesetter or proofreader or is_author %}
          {% if 'typesetting' in workflow_elements %}
            {% include "typesetting/elements/dashboard.html" %}
          {% endif %}
        {% endif %}

        {% for element in request.journal.workflow_plugin_elements %}
            {% if element.settings.dashboard_template %}
                {% include element.settings.dashboard_template %}
            {% endif %}
        {% endfor %}


        {% user_has_role request 'section-editor' as sectioneditor %}
        {% if sectioneditor %}
            <div class="large-12 columns end">
                <div class="box">
                    <div class="title-area">
                        <h2>Section Editor</h2>
                    </div>
                    <div class="content">
                        <table class="scroll">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Authors</th>
                                <th>Submitted</th>
                                <th>Current Stage</th>
                            </tr>
                            </thead>
                            {% for assignment in section_editor_articles %}
                                <tr>
                                    <td>{{ assignment.article.pk }}</td>
                                    <td>
                                        <a href="{{ assignment.article.current_workflow_element_url }}">{{ assignment.article.safe_title }}</a>
                                    </td>
                                    <td>{{ assignment.article.author_list|se_can_see_pii:assignment.article }}</td>
                                    <td>{{ assignment.article.date_submitted }}</td>
                                    <td>{{ assignment.article.get_stage_display }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4">No Articles Assigned</td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}


        {% if is_author %}
            {% include "admin/elements/core/author_dashboard.html" %}
        {% endif %}

    </section>
{% endblock body %}

{% block js %}
    {% if published_submissions %}{% include "admin/elements/datatables.html" with target="#published" sort=2 order="desc" %}{% endif %}
    {% include "admin/elements/datatables.html" with target="#active" sort=2 order="desc" %}
    {% include "admin/elements/datatables.html" with target="#incomplete" sort=2 order="desc" %}
{% endblock %}
