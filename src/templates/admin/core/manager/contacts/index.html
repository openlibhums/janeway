{% extends "admin/core/base.html" %}
{% load foundation %}
{% load static %}
{% load fqdn %}
{% load next_url %}

{% block title %}Contact Manager{% endblock title %}
{% block title-section %}Contact Manager{% endblock %}

{% block breadcrumbs %}
  {% include "elements/breadcrumbs/contacts_base.html" %}
{% endblock %}

{% block body %}
    <div class="large-12 columns">
        <div class="box">
            <div class="title-area">
                <h2>Current Contacts</h2>
                <a class="float-right small button success" href="{% url 'core_contact_person_search' %}"><i
                        class="fa fa-plus">&nbsp;</i>Add New Contact</a>
                <a class="button" href="{% url 'contact' %}" target="_blank"><i class="fa fa-eye">&nbsp;</i>View Contacts Page</a>
            </div>
            <div class="content">
                <p>
                    Contact people are listed below. You can alter their order by dragging and dropping them into the
                    order you require.
                </p>
                <p>
                    The contact link takes users to the contact page with the designated contact person preselected.
                </p>
                <form method="POST">
                    {% csrf_token %}
                    <table class="table scroll">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Link</th>
                            <th>Edit</th>
                            <th>Remove</th>
                        </tr>
                        </thead>
                        <tbody id="sortable">
                        {% for contact in contacts %}
                            <tr id="contact-{{ contact.pk }}">
                                <td><i class="fa fa-sort"></i></td>
                                <td>{{ contact.display_name }}</td>
                                <td>{{ contact.display_email }}</td>
                                <td>{{ contact.role }}</td>
                                <td>
                                  {% if contact.account %}
                                    {% if request.journal %}
                                      {% site_url "journal_contact_with_recipient" contact.account.uuid as content %}
                                    {% else %}
                                      {% site_url "press_contact_with_recipient" contact.account.uuid as content %}
                                    {% endif %}
                                    {% trans "Copy link" as label_copy %}
                                    {% trans "Link copied" as label_copied %}
                                    {% include "admin/elements/button_copy.html" with content=content label_copy=label_copy label_copied=label_copied size="small" %}
                                  {% endif %}
                                </td>
                                <td>
                                  <div class="button-group no-bottom-margin">
                                    {% url 'core_contact_person_update' contact.pk as href %}
                                    {% include "admin/elements/a_edit.html" with href=href %}
                                  </div>
                                </td>
                                <td>
                                  <div class="button-group no-bottom-margin">
                                    {% url_with_return "core_contact_person_delete" contact.pk as href %}
                                    {% include "admin/elements/a_remove.html" with href=href size="small" %}
                                  </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5">
                                    This site has no contacts.
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>
{% endblock body %}

{% block js %}
    <script src="{% static "admin/js/csrf.js" %}"></script>
    <script type="text/javascript" src="{% static "common/js/jq-ui.min.js" %}"></script>
    <script>
        $("#sortable").sortable({
            update: function (event, ui) {
                var data = $(this).sortable('serialize');
                console.log(data);
                // POST to server using $.post or $.ajax
                $.ajax({
                    data: data,
                    type: 'POST',
                    url: '{% url 'core_contact_people_reorder' %}'
                });
            }
        });
        $("#sortable").disableSelection();
    </script>
    {% include "admin/elements/button_copy_js.html" %}
{% endblock js %}
