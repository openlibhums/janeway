{% extends "admin/core/base.html" %}

{% block title %}Content Manager{% endblock title %}
{% block admin-header %}Content Manager{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li><a href="{% url 'core_manager_index' %}">Manager</a></li>
    <li>Content Manager</li>
{% endblock %}

{% block body %}
    <div class="large-6 columns">
        <div class="box">
            <div class="title-area">
                <h2>Pages</h2>
                <a class="button" href="{% url 'cms_page_new' %}"><i class="fa fa-plus">&nbsp;</i>Add New Page</a>
            </div>
            <div class="content">
                <table class="table small" id="pages">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>View</th>
                        <th>Edit</th>
                        <td>Delete</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% for page in pages %}
                        <tr>
                          <td>{{ page.display_name }} (/site/{{ page.name }})</td>
                          <td>
                            {% url 'cms_page' page.name as item_href %}
                            {% with href=item_href label="View" size="small" %}
                              {% include "elements/a_menu_item.html" %}
                            {% endwith %}
                          </td>
                          <td>
                            {% url 'cms_page_edit' page.pk as edit_href %}
                            {% with href=edit_href size="small" %}
                              {% include "elements/a_edit.html" %}
                            {% endwith %}
                          </td>
                          <td>
                            <form method="POST">
                              {% csrf_token %}
                              {% with name="delete" value=page.pk size="small" confirm="confirm" %}
                                {% include "elements/button_delete.html" %}
                              {% endwith %}
                            </form>
                          </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="large-6 columns">
        <div class="box">
            <div class="title-area">
                <h2>Navigation</h2>
                <a class="button" href="{% url 'cms_nav' %}"><i class="fa fa-pencil">&nbsp;</i>Modify Nav</a>
            </div>
            <div class="content">
                <p>Your custom navigation currently looks like this: </p>
                {% include "admin/elements/cms_nav.html" %}
            </div>
        </div>
    </div>
    {% if request.journal %}
    <div class="large-6 columns">
        <div class="box">
            <div class="title-area">
                <h2>XSLT</h2>
            </div>
            <p class="bs-callout bs-callout-warning">
              <span class="fa fa-warning"></span>
              Changing the Current XSL will only  affect future uploads.
            </p>
            <ul class="accordion" data-accordion data-allow-all-closed="true" data-multi-expand="true">
                {% for xsl in xsl_files %}
                    <li class="accordion-item" data-accordion-item>
                        <a href="#" class="accordion-title">
                            {% if journal.xsl == xsl %}<i class="fa fa-check-circle"></i>{% endif %}
                            {{ xsl.label }}
                            {% if journal.xsl == xsl %}<i>(current)</i>{% endif %}
                        </a>
                        <div class="accordion-content" data-tab-content>
                            <ul>
                                <li>Date Uploaded: {{ xsl.date_uploaded|date:"Y-m-d" }}</li>
                                {% if xsl.comments %}
                                <li>Comments: {{ xsl.comments|linebreaksbr }}</li>
                                {% endif %}
                            </ul>
                            {% if journal.xsl != xsl %}
                            <form method="POST">
                                {% csrf_token %}
                                {% with label="Make current" name="change_xsl" value=xsl.pk %}
                                  {% include "elements/button_restore.html" %}
                                {% endwith %}
                            </form>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="large-6 columns">
        <div class="box">
            <div class="title-area">
                <h2>XSLT</h2>
            </div>
            <div class="title-area card-divider">
                <h5>Upload new stylesheet</h5>
            </div>
            <div class="content">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ xsl_form}}
                    {% with name="new_xsl" hierarchy="secondary" %}
                      {% include "elements/button_upload.html" %}
                    {% endwith %}
                </form>
            </div>
            </div>
    </div>
    {% endif %}
{% endblock body %}

{% block js %}
    {% include "admin/elements/datatables.html" with target="#pages" %}
{% endblock js %}

