{% load static %}
{% load securitytags %}
{% load i18n %}
{% load uuid %}

{% get_uuid4 as pid %}

<div data-give-me-options-{{ pid }} class="give-me-options callout secondary">
  <div class="flex wrap gap-1 items-center">
    <strong>
      <span class="fa fa-envelope"></span>
      {% trans "Correspondence author" %}
    </strong>
    {% if article.non_correspondence_authors.exists %}
      <div class="button-group no-bottom-margin">
        <button
          class="button hollow secondary"
          aria-expanded="false"
          aria-controls="options-pane-{{ pid }}">
          <span class="fa fa-angle-up"></span>
          <span class="fa fa-angle-down"></span>
          {% trans "Change correspondence" %}
        </button>
      </div>
    {% endif %}
  </div>
  <div id="options-pane-{{ pid }}" class="options-pane padding-block-1">
    <p class="max-w-48">{% blocktrans %}
      The correspondence author can be any author who has a valid email
      address, independent of order. They will receive updates and requests
      for work on the article during the review and publication process.
    {% endblocktrans %}</p>
    <form method="POST">
      {% csrf_token %}
      <fieldset>
        <legend>{% trans "Select a new correspondence author:" %}</legend>
        {% for order in article.articleauthororder_set.all %}
          <div class="option">
            <input
              id="option_{{ order.author.pk }}"
              name="corr_author"
              type="radio"
              {% if order.author == article.correspondence_author %}
                checked
              {% endif %}
              value="{{ order.author.pk }}"
              {% if not order.author.real_email %}
                disabled
              {% endif %}
            >
            <label for="option_{{ order.author.pk }}">
              {{ order.author.full_name|se_can_see_pii:article }}
              {% if order.author.real_email %}
                {% blocktrans with email=order.author.real_email|se_can_see_pii:article %}
                  ({{ email }})
                {% endblocktrans %}
              {% else %}
                {% trans "(no email address)" %}
              {% endif %}
            </label>
          </div>
        {% endfor %}
      </fieldset>
    </form>
  </div>
</div>

{% include "admin/elements/give_me_options_js.html" with pid=pid %}
