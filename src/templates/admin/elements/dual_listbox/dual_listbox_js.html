<script type="text/javascript">

    function updateSelectedAccounts() {
        var selectedIds = [];
        $('#selectedMembers tbody tr').each(function() {
            selectedIds.push($(this).find('td.id-column').text());
        });
        $('#selectedAccounts').val(selectedIds.join(','));
    }

    function setSelectedRowHtml(row) {
        var id = row.find('td.id-column').text();
        var username = row.find('td:nth-child(3)').text();
        var affiliation = row.find('td:nth-child(4)').text();

        return '<tr class="tag-selected" id="account-' + id + '">' +
            '<td width="5%"><i class="fa fa-minus" style="color: red;"></i></td>' +
            '<td style="display: none;" class="id-column">' + id + '</td>' +
            '<td>' + username + '</td>' +
            '<td>' + affiliation + '</td>' +
            '<td class="destroy-tag-selected"><a><i class="fa fa-trash">&nbsp;</i></a></td>' +
            '</tr>';
    }

    function setAvailableRowHtml(row) {
        var id = row.find('td.id-column').text();
        var username = row.find('td:nth-child(3)').text();
        var affiliation = row.find('td:nth-child(4)').text();

        return'<tr>' +
            '<td width="5%"><i class="fa fa-plus" style="color: green;"></i></td>' +
            '<td style="display: none;" class="id-column">' + id + '</td>' +
            '<td>' + username + '</td>' +
            '<td>' + affiliation + '</td>' +
            '</tr>';
    }

    $(document).ready(function() {

        var selectedMembersTableBody = $('#selectedMembers tbody');
        var availableMembersTableBody = $('#availableMembers tbody');
        var searchInput = $('#searchInput');

        searchInput.on('input', function() {
            var searchText = $(this).val().toLowerCase();
            $('#availableMembers tbody tr').each(function() {
                var username = $(this).find('td:nth-child(3)').text().toLowerCase();
                $(this).toggle(username.indexOf(searchText) !== -1);
            });
        });

        availableMembersTableBody.on('click', 'tr', function() {
            var row = $(this);
            var newRowHtml = setSelectedRowHtml(row)
            row.remove();
            selectedMembersTableBody.append(newRowHtml);
            updateSelectedAccounts();
        });

        selectedMembersTableBody.on('click', '.destroy-tag-selected', function() {
            var row = $(this).closest('tr');
            var newRowHtml = setAvailableRowHtml(row)
            row.remove();
            availableMembersTableBody.append(newRowHtml);
            updateSelectedAccounts();
        });

        function rowExists(table, id) {
            return $(table).find('td:contains("' + id + '")').length > 0;
        }
    });
</script>