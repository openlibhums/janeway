{% extends "core/base.html" %}
{% load static %}
{% load i18n %}
{% load truncate %}

{% block css %}
  {% include "common/repository/style/submission_type_pills.html" %}
{% endblock css %}

{% block title %}
    {% if rou %}
        {{ rou.name }} - {{ request.repository.name }}
    {% elif subject %}
        {{ subject.name }} {{ request.repository.object_name_plural }}
    {% else %}
        {% trans "All" %} {{ request.repository.object_name_plural }}
    {% endif %}
{% endblock %}

{% block body %}
<section id="content">
    <div class="row">
        <div class="large-8 columns border-right">
            <div class="large-12 columns">
                <h1>
                    {% if rou %}
                        {{ rou.name }} {{ request.repository.object_name_plural }}
                    {% else %}
                        {{ request.repository.object_name_plural|capfirst }}
                    {% endif %}
                </h1>
                <p>
                    {% if search_term %}
                        Search for <em>{{ search_term }}</em> ({{ preprints.paginator.count }} results)
                    {% elif subject %}
                        Filtering by Subject: {{ subject }}
                    {% endif %}
                </p>
                <p>
                    There {% if preprints.paginator.count == 1 %}is{% else %}are{% endif %}
                    {{ preprints.paginator.count }}
                    {% if preprints.paginator.count == 1 %}
                        {{ request.repository.object_name }}
                    {% else %}
                        {{ request.repository.object_name_plural }}
                    {% endif %}
                    listed{% if rou and rou.children.exists %}, including those from sub-units of {{ rou.name }}{% endif %}.
                </p>

            </div>
            {% for preprint in preprints %}
                <div class="box article">

                    <div class="clearfix">
                        <div class="large-12s columns end">
                            <h2><a href="{% url 'repository_preprint' preprint.pk %}">{{ preprint.title|safe }}</a></h2>
                            <p>{{ preprint.display_authors_compact }}</p>
                            <p>
                                <span class="date">
                                    {% include "repository/elements/submission_type_pill.html" %} &nbsp;
                                    <i class="fa fa-calendar"></i>
                                    {{ preprint.date_published|date:"Y-m-d" }}&nbsp;&nbsp;
                                    <i class="fa fa-paperclip"></i>
                                    {% include "common/repository/subject_display.html" %}&nbsp;
                                    {% if preprint.organisation_units.all %}<i class="fa fa-link"></i>{% endif %}
                                    {% for rou in preprint.organisation_units.all %}
                                    <a href="{% url 'repository_preprints_by_rou' rou.code %}">
                                        {{ rou.name }}</a>{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </span>
                            </p>
                            <p>{{ preprint.abstract|striptags|truncatesmart:400 }}</p>
                        </div>
                    </div>
                    <hr />
                </div>
            {% endfor %}
            <div class="pagination-block">
                <ul class="pagination">
                    {% if preprints.has_previous %}
                        <li class="arrow"><a href="?page={{ preprints.previous_page_number }}">&laquo;</a></li>
                    {% endif %}
                    {% for page in preprints.paginator.page_range %}
                        <li class="{% if preprints.number == page %}current{% endif %}">
                            <a href="?page={{ page }}">{{ page }}</a>
                        </li>
                    {% endfor %}
                    {% if preprints.has_next %}
                        <li class="arrow"><a href="?page={{ preprints.next_page_number }}">&raquo;</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
        <aside class="large-4 columns" data-sticky-container>
          <div class="sticky" data-sticky data-margin-top="0" data-anchor="content">
              <div class="section">
                  <form method="get" action="{% url 'repository_list' %}">
                      <div class="input-group">
                            <span class="input-group-label"><i class="fa fa-search"></i></span>
                            <input class="input-group-field" type="search" name="search_term"
                                   placeholder="{% trans "Search" %}"
                                   value="{{ form.search_term.value|default_if_none:'' }}">
                        </div>

                      {{ form.subject.label_tag }}
                      {{ form.subject }}

                      {{ form.submission_type.label_tag }}
                      {{ form.submission_type }}

                      <button type="submit" class="button small expanded">
                          {% trans "Apply Filters" %}
                      </button>
                  </form>
              </div>

              <div class="section">
                  <h6 class="subheader">{% trans "You can search by" %}:</h6>
                  <ul class="no-bullet small">
                      <li>{% trans "Title" %}</li>
                      <li>{% trans "Keywords" %}</li>
                      <li>{% trans "Author Name" %}</li>
                      <li>{% trans "Author Affiliation" %}</li>
                  </ul>
              </div>

              {% if subject and subject.editors.exists %}
                  <div class="section">
                      <h5>{{ subject.name }} {% trans "Editors" %}</h5>
                      <ul>
                          {% for editor in subject.editors.all %}
                              <li>{{ editor.full_name }}</li>
                          {% endfor %}
                      </ul>
                  </div>
              {% endif %}
          </div>
      </aside>

    </div>
</section>
{% endblock %}
